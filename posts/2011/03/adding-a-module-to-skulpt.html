<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Adding a module to Skulpt | A Reputable Journal</title>

                <link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

                <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">

      <link rel="canonical" href="http://reputablejournal.com/posts/2011/03/adding-a-module-to-skulpt.html">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    

    
    <meta name="author" content="Brad Miller">
            <meta name="og:title" content="Adding a module to Skulpt">
        <meta name="og:url" content="http://reputablejournal.com/posts/2011/03/adding-a-module-to-skulpt.html">
            <meta name="og:description" content="Now that I'm back from traveling in South America I've started on a project to add a turtle graphics module to skulpt.  Skulpt is a javascript implementation of Python written by Scott Graham, and is ">
        <meta name="og:site_name" content="A Reputable Journal">
        <meta name="og:type" content="article">

    
    

</head>
<body>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://reputablejournal.com/">

                <span id="blog-title">A Reputable Journal</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                                <li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../galleries">Photos</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>

                
            </li>
</ul>

            <ul class="nav navbar-nav navbar-right">
                
            </ul>
        </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
        <header>
            <h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Adding a module to Skulpt</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Brad Miller</span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2011-03-19T00:00:00+00:00" itemprop="datePublished" title="Publication date">2011-03-19 00:00</time></a></p>
                <p class="commentline">        </p>
<div class="g-commentcount" data-href="/posts/2011/03/adding-a-module-to-skulpt.html"></div>
<script src="https://apis.google.com/js/plusone.js"></script>


        </div>
        
    </header>

    <div class="e-content entry-content" itemprop="articleBody text">
    <p>Now that I'm back from traveling in South America I've started on a project to add a turtle graphics module to skulpt.  Skulpt is a javascript implementation of Python written by Scott Graham, and is available on skulpt.googlecode.com.  Its a very nice project because it allows you to embed a Python interpreter right in your web page.  I've written about how to do this <a href="http://blog.bonelakesoftware.com/2011/02/python-in-your-browser-in-javascript.html">in a previous post.</a><br>The skulpt interpreter works like a charm, but it does not yet have any of the Python standard library modules implemented.  Scott has been working with wrapping some of Googles closure libraries, and has a webgl module too.  But none of your regular Python friends are available, things like math, random, turtle, etc need to be implemented.  For the most part these things are already available in javascript so the work is in creating the module and then wrapping the underlying Javascript inside the standard Python API.<br>Where to start?  There's not a lot of documentation provided for skulpt, so I'm hoping this post will be enough to help others get going a bit quicker.  Scott was very helpful in responding to all my emails so this is not a criticism of him, rather I'm hoping this will save him the effort the next time someone wants to extend skulpt.  So, here's the deal.  skulpt relies on two javascript files the first is skulpt.js  and builtin.js  A very minimal installation only uses skulpt.js, whereas if you want to use any modules they are in builtin.js.  Looking around the distribution you will not immediately find skulpt.js because you need to build it. You get a sculpt.js file by using the m script that comes with the distribution.  running m --help will give you the full list of commands, but the two that you probably most care about are <span style="text-decoration: underline;">m dist</span> and <span style="text-decoration: underline;">m docbi</span> The dist command builds both skulpt.js and builtin.js  docbi builds builtin.js and puts a new copy of it in the doc/static directory.<br>Lets begin with a quick tour of the source tree:<br></p>
<ul>
<li>
<strong>src</strong> - contains the implementation of the Python interpreter</li>
<li>
<strong>src/lib</strong> - has the module implementations of webgl and goog.  This is where turtle will live and any other modules I implement along the way.</li>
<li>
<strong>doc</strong> - This directory contains a google app engine application and is what you see on <a href="http://skulpt.org/">skulpt.org</a> There are a couple of important files to check out in here.  One of them is doc/static/env/editor.js  This is the code that ties together the interactive editor on the home page with the skulpt interpreter and the <a href="http://codemirror.net/">codemirror</a> editor.  If you know how to build a google app engine app then this directory makes sense.  One thing about the home page is that it is not set up to use any of the modules.  The modules are used in the more advanced ide, which you can find in doc/ide/static.  I'm going to tell you how to add modules to the simpler editor later in this article.</li>
<li>
<strong>test</strong> - this directory contains a bunch of files for testing the implementation in a batch mode.  These tests are run whenever you run m dist, or m test.</li>
<li>
<strong>dist</strong> - This directory gets created and populated when you run the m dist command.  It contains the built and compressed versions of skulpt.js and builtin.js</li>
</ul>To illustrate how to make use of modules, here's an extended version of my earlier hello world style example.<br><br><pre>&lt;html&gt;<br>&lt;head&gt;<br>&lt;script src="skulpt.js" type="text/javascript"&gt;&lt;/script&gt;<br>&lt;script src="builtin.js" type="text/javascript"&gt;&lt;/script&gt;<br><br>&lt;/head&gt;<br><br>&lt;body&gt;<br>&lt;script type="text/javascript"&gt;<br>function outf(text) {<br>   var mypre = document.getElementById("output");<br>   mypre.innerHTML = mypre.innerHTML + text;<br>}<br><br>function builtinRead(x)<br>{<br>    if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)<br>        throw "File not found: '" + x + "'";<br>    return Sk.builtinFiles["files"][x];<br>}<br><br>function runit() {<br>   var prog = document.getElementById("yourcode").value;<br>   var mypre = document.getElementById("output");<br>   mypre.innerHTML = '';<br>   Sk.configure({output:outf,<br>           read: builtinRead<br>              });<br>   try {<br>      Sk.importMainWithBody("&lt;stdin&gt;",false,prog);<br>   } catch (e) {<br>      alert(e);<br>   }<br>}<br>&lt;/script&gt;<br>&lt;h3&gt;Try This&lt;/h3&gt;<br>&lt;form&gt;<br>&lt;textarea edit_id="eta_5" id="yourcode"&gt;<br>print "Hello World"<br>&lt;/textarea&gt;<br>&lt;button onclick="runit()" type="button"&gt;Run&lt;/button&gt;<br>&lt;/form&gt;<br><br>&lt;pre id="output"&gt;&lt;/pre&gt;<br><br>&lt;/body&gt;<br>&lt;/html&gt;</pre>
<div></div>
<pre><br></pre>There are some important differences between this version, and the version and the non-module version.  First off, the call to Sk.configure contains another key value pair which sets up a specialized read function.  This is the function that is responsible for returning your module out of the large array of files that are contained in the builtin.js file.  You will see that all of the modules are contained in this one file, stored in a big JSON structure.  The extra key value pair is:<br>read: builtinRead<br>The read function is just for loading modules and is called when you do an import statement of some kind.  In this case the function accesses the variable builtinFiles which is created from the builtin.js file.  The other difference, of course, is that you have to include builtin.js in your html file.  Note that builtin.js must be included after skulpt.js<br>Now as far as the module itself goes, the easiest thing to do is to start your module in the src/lib directory.  This way it will automatically get built and included in builtin.js.  If you don't put it there then you are going to have to modify the m script, specifically the docbi function in the m script to include your module.  Suppose that you want to have a module called bnm.test  Here's what you have to do.  First, you need to make a bnm directory under lib.  In this directory you will need to have either <strong>init</strong>.py or <strong>init</strong>.js or bnm.js to stand in for the bnm module.  There doesn't need to be anything in the file as long as it exists.  This is just like CPython by the way.  Then to make a test module you can either make a test directory and put all your javascript code in <strong>init</strong>.js or you can simply create a test.js file in the bnm directory.  Lets look at the test module.<br><pre class="prettyprint">var $builtinmodule = function(name)<br>{<br>    var mod = {};<br>    var myfact = function(n) {<br> if(n &lt; 1) {<br>     return 1;<br> } else {<br>     return n * myfact(n-1);<br> }<br>    }<br>    mod.fact = new Sk.builtin.func(function(a) {<br> return myfact(a);<br>    });</pre>
<pre><br>    mod.Stack = Sk.misceval.buildClass(mod, function($gbl, $loc) {<br> $loc.<strong>init</strong> = new Sk.builtin.func(function(self) {<br>     self.stack = [];<br> });<br> <br> $loc.push = new Sk.builtin.func(function(self,x) {<br>     self.stack.push(x);<br> });<br> $loc.pop = new Sk.builtin.func(function(self) {<br>     return self.stack.pop();<br> });<br>    },<br>    'Stack', []);<br><br><br>    return mod;<br>}</pre>
<br>All modules start out with the $var builtinmodule = statement.<br>This test module exposes a single method to the outside world, called fact, There are a couple of key functions for building up a module.  The Sk.builtin.func   call for adding functions to your module, and the Sk.misceval.buildClass method.  This test module defines a simple factorial function called fact, and a class called stack.  Here's a simple Python program that exercises the module:<br><pre>import bnm.test</pre>
<pre>print 'starting'</pre>
<pre>print bnm.test.fact(10)</pre>
<pre>x = bnm.test.Stack()</pre>
<pre>x.push(1)</pre>
<pre>x.push(2)</pre>
<pre>print x.pop()</pre>
<pre>print 'done'</pre>
<br>Its not obvious, but the buildClass method takes four parameters:  globals, func, name, bases<br>It seems that you always pass the mod object itself as the globals parameter, the func parameter is a function that represents the class object, the Name is the external name of the class, and bases presumably would be if the class is inheriting from another class.<br>The Sk.builtin.func method creates a function.  For module creation we typically only have to worry about the one parameter, func, which is the javascript implementation of our Python function.  The method can also take a globals object and two closure objects.  Look at the comments in function.js if you want more explanation of how the builtin.func method works.<br>Well, I think this should be enough to get you going.  Its worth repeating, if you made it this far, don't forget to call m docbi or m dist after you make changes in your module, its easy to get into the mode of thinking that the new javascript is automatically loaded.  But builtin.js is not automatically rebuilt!<br>I'll consider this post a work in progress, please leave a comment if something is unclear or you would like something explained in more detail.<br><div class="blogger-post-footer"><img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/2759017781463016019-6096495771804140916?l=blog.bonelakesoftware.com" alt=""></div>
    </div>
    <aside class="postpromonav">
    <nav>
            <ul itemprop="keywords" class="tags">
           <li><a class="tag p-category" href="../../../categories/python.html" rel="tag">Python</a></li>
        </ul>

            <ul class="pager">
            <li class="previous">
                <a href="cruise-wrapup-part-ii.html" rel="prev" title="Cruise Wrapup Part II">Previous post</a>
            </li>
            <li class="next">
                <a href="iguazu-falls-postscript.html" rel="next" title="Iguazu Falls Postscript">Next post</a>
            </li>
        </ul>

    </nav>
    </aside>
        <section class="comments">
        <h2>Comments</h2>
                <script src="https://apis.google.com/js/plusone.js"></script>
<div class="g-comments" data-href="http://reputablejournal.com/posts/2011/03/adding-a-module-to-skulpt.html" data-first_party_property="BLOGGER" data-view_type="FILTERED_POSTMOD">
</div>


        </section>
    
</article>
        

        </div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:bonelake@mac.com">Brad Miller</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
    </div>
</div>

            <script src="../../../assets/js/all-nocdn.js"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script>jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>

 <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-32638348-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


<a href="https://plus.google.com/+BradMillerNorse?rel=author">Google</a>
</body>
</html>
